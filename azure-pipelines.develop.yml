trigger:
  - manual

variables:
  npmCacheDir: "/home/vsts/.npm"

jobs:
  - job: dependencies
    displayName: Cache npm dependencies
    pool:
      vmImage: ubuntu-latest
    steps:
      - task: NodeTool@0
        displayName: Install Node 16
        inputs:
          versionSpec: "16.x"

      - task: Cache@2
        inputs:
          key: '"node_modules2" | "$(Agent.OS)" | package.json'
          path: node_modules
          cacheHitVar: NODE_MODULES_CACHE_HIT
      
      - script: |
          npm install
        condition: eq(variables.NODE_MODULES_CACHE_HIT, 'false')
        displayName: Install dependencies and cache

  - job: build
    displayName: build
    pool:
      vmImage: ubuntu-latest
    steps:
      - task: NodeTool@0
        displayName: Install Node 16
        inputs:
          versionSpec: "16.x"
      
      - task: Cache@2
        inputs:
          key: '"node_modules2" | "$(Agent.OS)" | package.json'
          path: node_modules
          cacheHitVar: NODE_MODULES_CACHE_HIT

      - script: |
          npm install
        condition: eq(variables.NODE_MODULES_CACHE_HIT, 'false')
        displayName: Install dependencies
      
      - script: |
          npm run lint
          npm run build
          npm run build:ladle
        displayName: "Lint and build"